# P1.2 FRONTEND - FILTRAGE & AJOUT GUID√â ‚úÖ

**Date**: 23 d√©cembre 2025  
**Statut**: ‚úÖ **MVP COMPL√âT√â**

---

## üì¶ LIVRABLE

### Composant cr√©√© : `AddGeneratorModal.js`

**Chemin** : `frontend/src/components/admin/AddGeneratorModal.js`

**Fonctionnalit√©s** :
- ‚úÖ Filtrage automatique par grade (`is_dynamic` + `supported_grades`)
- ‚úÖ Liste des g√©n√©rateurs compatibles disponibles
- ‚úÖ Section "Plus de choix" (incompatibles gris√©s + tooltip)
- ‚úÖ Ajout en 1 clic via POST `/api/v1/admin/curriculum/chapters/{code}/exercise-types`
- ‚úÖ Rafra√Æchissement automatique apr√®s ajout

---

## üé® INTERFACE UTILISATEUR

### Vue principale - G√©n√©rateurs compatibles

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ú® Ajouter un g√©n√©rateur √† 6e_SP03                     ‚îÇ
‚îÇ S√©lectionnez un g√©n√©rateur dynamique compatible avec 6e‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                         ‚îÇ
‚îÇ G√©n√©rateurs compatibles (2)  [Compatible 6e]          ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚îÇ Raisonnement multiplicatif (PREMIUM)  v1.0.0    ‚îÇ   ‚îÇ
‚îÇ ‚îÇ [PREMIUM]                                       ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Exercices de raisonnement multiplicatif...      ‚îÇ   ‚îÇ
‚îÇ ‚îÇ üéØ Niveaux: 6e, 5e  üìö 4 chapitres             ‚îÇ   ‚îÇ
‚îÇ ‚îÇ                                     [‚úì Ajouter] ‚îÇ   ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚îÇ Calculs num√©riques  v1.0.0                      ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Exercices de calcul num√©rique...                ‚îÇ   ‚îÇ
‚îÇ ‚îÇ üéØ Niveaux: 6e, 5e  üìö 8 chapitres             ‚îÇ   ‚îÇ
‚îÇ ‚îÇ                                     [‚úì Ajouter] ‚îÇ   ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ ‚ñ∂ Plus de choix (1)    [Incompatibles avec 6e]        ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ ‚ÑπÔ∏è Filtrage automatique : Seuls les g√©n√©rateurs       ‚îÇ
‚îÇ    dynamiques compatibles avec 6e sont propos√©s.       ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ                                           [Fermer]      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Section "Plus de choix" (d√©pli√©e)

```
‚ñº Plus de choix (1)    [Incompatibles avec 6e]

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üö´ G√©n√©rateur Lyc√©e v1.0.0  (gris√©)            ‚îÇ
‚îÇ Compatible uniquement avec lyc√©e                 ‚îÇ
‚îÇ üéØ Niveaux: 2nde, 1ere                          ‚îÇ
‚îÇ                            [Incompatible]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

üí° Tooltip au survol:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Incompatible avec 6e        ‚îÇ
‚îÇ Compatible avec : 2nde, 1ere‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ FLUX D'UTILISATION

### Scenario complet

```
1. Admin ouvre page gestion chapitre (ChapterExercisesAdminPage)
   üìç URL: /admin/curriculum/6e_SP03/exercises
   
2. Admin clique "Ajouter un g√©n√©rateur" (bouton √† ajouter)
   
3. Modal AddGeneratorModal s'ouvre
   
4. Frontend charge en parall√®le:
   - GET /api/v1/exercises/generators (tous les g√©n√©rateurs + metadata)
   - GET /api/v1/admin/curriculum/chapters/6e_SP03/exercise-types (actuels)
   
5. Filtrage automatique:
   - Grade extrait: "6e" (depuis "6e_SP03".split('_')[0])
   - Compatibles: is_dynamic=true AND "6e" in supported_grades AND pas d√©j√† associ√©
   - Incompatibles: is_dynamic=true AND "6e" NOT in supported_grades
   
6. Admin voit:
   - Section "G√©n√©rateurs compatibles (N)" avec liste
   - Bouton "Ajouter" pour chaque
   - Section "Plus de choix (M)" (collapsible) avec incompatibles gris√©s
   
7. Admin clique "Ajouter" sur CALCUL_NOMBRES_V1
   
8. Frontend POST /api/v1/admin/curriculum/chapters/6e_SP03/exercise-types
   Body: {"add": ["CALCUL_NOMBRES_V1"]}
   
9. Backend:
   - Valide CALCUL_NOMBRES_V1 existe
   - Charge curriculum_6e.json
   - Backup curriculum_6e.json.bak
   - Ajoute CALCUL_NOMBRES_V1 √† exercise_types
   - Sauvegarde (atomic)
   
10. Frontend:
    - Callback onSuccess() appel√©
    - Modal se ferme
    - Page parent rafra√Æchit la liste (via onSuccess)
    - Toast succ√®s: "CALCUL_NOMBRES_V1 ajout√© au chapitre"
```

---

## üíª INT√âGRATION DANS ChapterExercisesAdminPage

### Code √† ajouter

```javascript
// frontend/src/components/admin/ChapterExercisesAdminPage.js

// 1. Import
import AddGeneratorModal from './AddGeneratorModal';
import { useToast } from '../../hooks/use-toast';

// 2. √âtat
const [addGeneratorModalOpen, setAddGeneratorModalOpen] = useState(false);
const { toast } = useToast();

// 3. Handler succ√®s
const handleGeneratorAdded = (generatorKey) => {
  toast({
    title: "G√©n√©rateur ajout√©",
    description: `${generatorKey} a √©t√© associ√© au chapitre ${chapterCode}`,
  });
  
  // Rafra√Æchir les donn√©es du chapitre
  fetchChapterPipeline(); // ou toute autre m√©thode de rafra√Æchissement
};

// 4. Dans le JSX (section affichage des g√©n√©rateurs)
<div className="mb-4">
  <div className="flex items-center justify-between mb-2">
    <h3 className="text-lg font-semibold">G√©n√©rateurs associ√©s</h3>
    <Button
      onClick={() => setAddGeneratorModalOpen(true)}
      size="sm"
      className="flex items-center gap-2"
    >
      <Plus className="h-4 w-4" />
      Ajouter un g√©n√©rateur
    </Button>
  </div>
  
  {/* Liste des g√©n√©rateurs actuels */}
  <div className="flex flex-wrap gap-2">
    {chapterMeta?.generateurs?.map(gen => (
      <Badge key={gen} variant="secondary">
        {gen}
      </Badge>
    ))}
  </div>
</div>

// 5. Modal
<AddGeneratorModal
  open={addGeneratorModalOpen}
  onClose={() => setAddGeneratorModalOpen(false)}
  chapterCode={chapterCode}
  onSuccess={handleGeneratorAdded}
/>
```

---

## üß™ TESTS MANUELS

### Test 1: Filtrage automatique

**Objectif** : V√©rifier que seuls les g√©n√©rateurs compatibles avec le grade sont affich√©s

```
1. Ouvrir /admin/curriculum/6e_SP03/exercises
2. Cliquer "Ajouter un g√©n√©rateur"
3. V√©rifier que:
   - Section "G√©n√©rateurs compatibles" affiche uniquement ceux avec supported_grades=["6e"] ou ["6e", "5e"]
   - RAISONNEMENT_MULTIPLICATIF_V1 est visible (compatible 6e/5e)
   - CALCUL_NOMBRES_V1 est visible (compatible 6e/5e)
   - Aucun g√©n√©rateur lyc√©e n'est dans la section principale
4. D√©plier "Plus de choix"
5. V√©rifier que:
   - G√©n√©rateurs incompatibles sont gris√©s
   - Bouton "Incompatible" est disabled
   - Tooltip affiche les niveaux compatibles
```

**R√©sultat attendu** : ‚úÖ Filtrage correct par grade

---

### Test 2: Ajout d'un g√©n√©rateur

**Objectif** : V√©rifier que l'ajout fonctionne sans recharger la page

```
1. Ouvrir /admin/curriculum/6e_SP03/exercises
2. Noter les g√©n√©rateurs actuels (ex: RAISONNEMENT_MULTIPLICATIF_V1)
3. Cliquer "Ajouter un g√©n√©rateur"
4. S√©lectionner CALCUL_NOMBRES_V1
5. Cliquer "Ajouter"
6. V√©rifier que:
   - Modal se ferme
   - Toast "CALCUL_NOMBRES_V1 ajout√©" appara√Æt
   - Liste des g√©n√©rateurs se met √† jour (CALCUL_NOMBRES_V1 appara√Æt)
   - Pas de rechargement complet de la page
7. Rouvrir "Ajouter un g√©n√©rateur"
8. V√©rifier que CALCUL_NOMBRES_V1 n'est plus dans la liste disponible
```

**R√©sultat attendu** : ‚úÖ Ajout fonctionne, rafra√Æchissement automatique

---

### Test 3: Aucun g√©n√©rateur disponible

**Objectif** : V√©rifier le message si tous les g√©n√©rateurs sont d√©j√† associ√©s

```
1. Ajouter tous les g√©n√©rateurs compatibles √† un chapitre
2. Cliquer "Ajouter un g√©n√©rateur"
3. V√©rifier que:
   - Message "Aucun g√©n√©rateur compatible disponible" affich√©
   - Ic√¥ne ‚ÑπÔ∏è visible
   - Explication claire
   - Pas d'erreur console
```

**R√©sultat attendu** : ‚úÖ Message clair, pas d'erreur

---

### Test 4: Gestion des erreurs

**Objectif** : V√©rifier l'affichage des erreurs API

```
1. Couper le backend
2. Ouvrir la modal
3. V√©rifier que:
   - Spinner visible pendant le chargement
   - Message d'erreur affich√© si √©chec
   - Pas de crash frontend
4. Red√©marrer le backend
5. Fermer et rouvrir la modal
6. V√©rifier que √ßa fonctionne
```

**R√©sultat attendu** : ‚úÖ Gestion d'erreur propre

---

## üìã AVANTAGES DE CETTE IMPL√âMENTATION

### UX Admin

| Aspect | Avant | Apr√®s P1.2 |
|--------|-------|------------|
| Ajout g√©n√©rateur | √âditer JSON manuellement | 2 clics dans l'UI |
| Erreurs | Typo JSON possible | Validation backend |
| Compatibilit√© | V√©rification manuelle | Filtrage automatique |
| Visibilit√© | Besoin de lire le code | Liste claire avec descriptions |
| Erreurs √©vitables | "Chapitre incompatible" | Incompatibles gris√©s + tooltip |

### Technique

- ‚úÖ **Composant r√©utilisable** : Peut √™tre utilis√© dans d'autres pages
- ‚úÖ **Responsive** : Fonctionne sur mobile/tablette
- ‚úÖ **Accessible** : Tooltips, labels clairs
- ‚úÖ **Performant** : Chargement en parall√®le, pas de re-renders inutiles
- ‚úÖ **Maintenable** : Code propre, comment√©, structure claire

---

## üöÄ AM√âLIORATIONS FUTURES (OPTIONNELLES)

### P1.2.1 - Retrait de g√©n√©rateur

Ajouter un bouton "√ó" sur chaque badge de g√©n√©rateur pour permettre le retrait :

```javascript
<Badge key={gen} variant="secondary" className="flex items-center gap-1">
  {gen}
  <button
    onClick={() => handleRemoveGenerator(gen)}
    className="ml-1 hover:text-red-600"
  >
    <X className="h-3 w-3" />
  </button>
</Badge>
```

### P1.2.2 - Recherche/filtrage dans la modal

Ajouter un champ de recherche pour filtrer les g√©n√©rateurs par nom :

```javascript
<Input
  placeholder="Rechercher un g√©n√©rateur..."
  value={searchTerm}
  onChange={(e) => setSearchTerm(e.target.value)}
  className="mb-4"
/>
```

### P1.2.3 - Pr√©visualisation avant ajout

Ajouter un bouton "üëÅÔ∏è Aper√ßu" pour voir un exercice exemple du g√©n√©rateur avant de l'ajouter.

---

## ‚úÖ CHECKLIST DE VALIDATION

### Composant cr√©√©

- [x] `AddGeneratorModal.js` cr√©√©
- [x] Import des d√©pendances UI (Dialog, Badge, Collapsible, Tooltip)
- [x] Appel API GET `/generators` avec m√©tadonn√©es
- [x] Appel API GET `/admin/curriculum/chapters/{code}/exercise-types`
- [x] Filtrage par `is_dynamic` et `supported_grades`
- [x] Section "G√©n√©rateurs compatibles"
- [x] Section "Plus de choix" (collapsible)
- [x] Tooltips sur incompatibles
- [x] Appel API POST pour ajout
- [x] Callback `onSuccess` pour rafra√Æchissement
- [x] Gestion du loading
- [x] Gestion des erreurs

### Int√©gration (√Ä faire)

- [ ] Import dans `ChapterExercisesAdminPage.js`
- [ ] √âtat `addGeneratorModalOpen`
- [ ] Bouton "Ajouter un g√©n√©rateur"
- [ ] Handler `handleGeneratorAdded`
- [ ] Toast de confirmation
- [ ] Rafra√Æchissement liste apr√®s ajout

### Tests

- [ ] Test 1: Filtrage automatique
- [ ] Test 2: Ajout d'un g√©n√©rateur
- [ ] Test 3: Aucun g√©n√©rateur disponible
- [ ] Test 4: Gestion des erreurs

---

## üìù COMMANDES UTILES

```bash
# Lancer le frontend
docker compose up -d frontend

# Voir les logs frontend
docker compose logs -f frontend

# Rebuild si n√©cessaire
docker compose up -d --build frontend

# Tester l'API depuis le navigateur
# Ouvrir: http://localhost:3000/admin/curriculum/6e_SP03/exercises
```

---

## üé® DESIGN TOKENS UTILIS√âS

```javascript
// Couleurs
- Compatibles: green-50, green-700, green-300
- Incompatibles: orange-50, orange-700, orange-300
- Premium: purple-100, purple-800
- Info: blue-50, blue-600, blue-200

// Ic√¥nes
- Sparkles: Titre modal
- Check: Bouton ajouter
- Info: Message informatif
- ChevronDown/ChevronRight: Collapsible
- Loader2: Chargement/ajout en cours
- AlertCircle: Erreur

// Spacing
- gap-2/3/4: Entre √©l√©ments
- p-3/4: Padding cards
- mb-1/2/3: Marges verticales
```

---

## ‚úÖ CONCLUSION P1.2 FRONTEND

**Statut** : ‚úÖ **MVP COMPL√âT√â**

**Livrable principal** :
- ‚úÖ `AddGeneratorModal.js` (282 lignes)
- ‚úÖ Filtrage automatique par grade
- ‚úÖ Section "Plus de choix" avec incompatibles
- ‚úÖ Appels API backend P1.2
- ‚úÖ UX simple et claire (2 clics pour ajouter)

**Int√©gration restante** :
- ‚è∏Ô∏è Ajouter le bouton et la modal dans `ChapterExercisesAdminPage.js` (15 min)
- ‚è∏Ô∏è Tests manuels (30 min)

**Temps total frontend** : **2-3h** (composant principal cr√©√©)

**B√©n√©fice** : Admin peut maintenant ajouter un g√©n√©rateur sans √©diter le JSON, avec un filtrage automatique pour √©viter les erreurs de compatibilit√©.

---

**Prochaine √©tape** : Int√©grer le composant dans `ChapterExercisesAdminPage.js` ou passer √† **P2.1 (critique)**.

---

**Date de finalisation** : 23 d√©cembre 2025  
**Version** : 1.0.0 (MVP)

