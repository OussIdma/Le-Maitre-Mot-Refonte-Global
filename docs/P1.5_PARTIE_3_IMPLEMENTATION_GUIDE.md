# P1.5 - Partie 3/3 : Guide d'Impl√©mentation UI Onglets

**Date :** 2025-12-23  
**Fichier cible :** `frontend/src/components/admin/ChapterExercisesAdminPage.js`  
**Statut :** ‚è∏Ô∏è **EN ATTENTE D'IMPL√âMENTATION**

---

## üéØ Objectif

Ajouter 2 onglets distincts dans la page admin d'un chapitre :
- üìÑ **Onglet Statiques** : Exercices fig√©s (CRUD via API)
- üß© **Onglet Dynamiques** : G√©n√©rateurs + templates

---

## ‚ö†Ô∏è Contrainte

Le fichier `ChapterExercisesAdminPage.js` fait **2100+ lignes**.  
‚Üí Une refonte compl√®te n'est pas recommand√©e (risque de r√©gression).

**Approche recommand√©e :**
1. **Court terme** : Modifications cibl√©es minimales (ce guide)
2. **Moyen terme** : Refonte modulaire (d√©couper en composants)

---

## üìã Modifications √† Apporter

### √âtape 1 : Ajouter les imports Tabs

**Ligne ~20** (apr√®s les imports existants) :

```javascript
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';
```

---

### √âtape 2 : Ajouter les √©tats pour les onglets

**Ligne ~100** (dans le composant, apr√®s les √©tats existants) :

```javascript
// P1.5 - Onglets Statiques/Dynamiques
const [activeTab, setActiveTab] = useState('dynamiques'); // 'dynamiques' | 'statiques'
const [staticExercises, setStaticExercises] = useState([]);
const [loadingStatic, setLoadingStatic] = useState(false);
const [staticError, setStaticError] = useState(null);
```

---

### √âtape 3 : Ajouter la fonction de chargement des exercices statiques

**Apr√®s les autres fonctions `fetch...`** (ligne ~300) :

```javascript
// P1.5 - Charger les exercices statiques
const fetchStaticExercises = useCallback(async () => {
  if (!chapterCode) return;
  
  setLoadingStatic(true);
  setStaticError(null);
  
  try {
    const response = await fetch(
      `${BACKEND_URL}/api/v1/admin/chapters/${chapterCode}/static-exercises`
    );
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    const data = await response.json();
    setStaticExercises(data);
  } catch (err) {
    console.error('[Static] Erreur chargement:', err);
    setStaticError(err.message);
  } finally {
    setLoadingStatic(false);
  }
}, [chapterCode]);
```

---

### √âtape 4 : Charger les exercices statiques quand l'onglet est activ√©

**Apr√®s le `useEffect` existant qui charge les exercices** (ligne ~400) :

```javascript
// P1.5 - Charger les statiques si onglet actif
useEffect(() => {
  if (activeTab === 'statiques') {
    fetchStaticExercises();
  }
}, [activeTab, fetchStaticExercises]);
```

---

### √âtape 5 : Modifier le rendu principal

**Chercher la div principale du rendu** (ligne ~1000-1100, chercher `<div className="container">` ou similaire).

**Remplacer le contenu APR√àS le header par :**

```javascript
{/* P1.5 - Onglets Statiques/Dynamiques */}
<Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
  <TabsList className="grid w-full grid-cols-2 mb-6">
    <TabsTrigger value="dynamiques" className="flex items-center gap-2">
      <Sparkles className="h-4 w-4" />
      Dynamiques (g√©n√©r√©s)
    </TabsTrigger>
    <TabsTrigger value="statiques" className="flex items-center gap-2">
      <BookOpen className="h-4 w-4" />
      Statiques (fig√©s)
    </TabsTrigger>
  </TabsList>

  {/* Onglet Dynamiques */}
  <TabsContent value="dynamiques">
    {/* 
      ICI : Garder tout le contenu existant actuel de la page
      (liste des g√©n√©rateurs, modals, etc.)
    */}
    <Alert className="mb-4 bg-blue-50 border-blue-200">
      <Sparkles className="h-4 w-4 text-blue-600" />
      <AlertDescription className="text-blue-800">
        <strong>Exercices dynamiques :</strong> Utilisent des g√©n√©rateurs et des templates √©ditables.
        <Link to="/admin/templates" className="ml-2 underline">
          G√©rer les templates ‚Üí
        </Link>
      </AlertDescription>
    </Alert>
    
    {/* 
      IMPORTANT : Garder ici tout le code JSX actuel (entre ligne ~1100 et ~2000)
      Ne PAS le supprimer, juste l'encapsuler dans ce TabsContent
    */}
  </TabsContent>

  {/* Onglet Statiques */}
  <TabsContent value="statiques">
    {renderStaticExercisesTab()}
  </TabsContent>
</Tabs>
```

---

### √âtape 6 : Cr√©er la fonction de rendu de l'onglet Statiques

**Avant le `return` principal** (ligne ~1000) :

```javascript
// P1.5 - Rendu de l'onglet Statiques
const renderStaticExercisesTab = () => {
  if (loadingStatic) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="h-8 w-8 animate-spin text-blue-600 mr-3" />
        <span>Chargement des exercices statiques...</span>
      </div>
    );
  }

  if (staticError) {
    return (
      <Alert variant="destructive">
        <AlertCircle className="h-4 w-4" />
        <AlertDescription>
          Erreur lors du chargement des exercices statiques : {staticError}
        </AlertDescription>
      </Alert>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header avec bouton Ajouter */}
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-lg font-semibold">Exercices statiques</h3>
          <p className="text-sm text-gray-600 mt-1">
            Exercices r√©dig√©s manuellement avec contenu fig√©
          </p>
        </div>
        <Button onClick={handleCreateStatic}>
          <Plus className="h-4 w-4 mr-2" />
          Ajouter un exercice statique
        </Button>
      </div>

      {/* Liste des exercices statiques */}
      {staticExercises.length === 0 ? (
        <Card className="p-12 text-center">
          <BookOpen className="h-12 w-12 mx-auto text-gray-400 mb-4" />
          <p className="text-gray-600 mb-4">Aucun exercice statique dans ce chapitre</p>
          <Button variant="outline" onClick={handleCreateStatic}>
            <Plus className="h-4 w-4 mr-2" />
            Cr√©er le premier exercice statique
          </Button>
        </Card>
      ) : (
        <Card>
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead>Type</TableHead>
                <TableHead>Titre / √ânonc√©</TableHead>
                <TableHead>Difficult√©</TableHead>
                <TableHead>Ordre</TableHead>
                <TableHead>Mis √† jour</TableHead>
                <TableHead className="text-right">Actions</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {staticExercises.map((exercise) => (
                <TableRow key={exercise.id}>
                  <TableCell>
                    <Badge variant="outline" className="bg-green-50 text-green-700 border-green-200">
                      üìÑ Statique
                    </Badge>
                  </TableCell>
                  <TableCell>
                    <div className="max-w-md">
                      {exercise.title && (
                        <div className="font-medium mb-1">{exercise.title}</div>
                      )}
                      <div 
                        className="text-sm text-gray-600 truncate"
                        dangerouslySetInnerHTML={{ 
                          __html: exercise.enonce_html.replace(/<[^>]+>/g, ' ').substring(0, 80) + '...' 
                        }}
                      />
                    </div>
                  </TableCell>
                  <TableCell>
                    <Badge className={getDifficultyColor(exercise.difficulty)}>
                      {exercise.difficulty}
                    </Badge>
                  </TableCell>
                  <TableCell>{exercise.order || '‚Äî'}</TableCell>
                  <TableCell className="text-sm text-gray-500">
                    {exercise.updated_at 
                      ? new Date(exercise.updated_at).toLocaleDateString('fr-FR')
                      : '‚Äî'
                    }
                  </TableCell>
                  <TableCell className="text-right">
                    <div className="flex items-center justify-end gap-2">
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={() => handleEditStatic(exercise)}
                      >
                        <Pencil className="h-4 w-4" />
                      </Button>
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={() => handleDeleteStatic(exercise)}
                      >
                        <Trash2 className="h-4 w-4 text-red-600" />
                      </Button>
                    </div>
                  </TableCell>
                </TableRow>
              ))}
            </TableBody>
          </Table>
        </Card>
      )}
    </div>
  );
};
```

---

### √âtape 7 : Ajouter les handlers pour les actions CRUD statiques

**Apr√®s les autres handlers** (ligne ~600) :

```javascript
// P1.5 - Handlers pour exercices statiques

const handleCreateStatic = () => {
  // TODO: Ouvrir modal de cr√©ation
  // POST /api/v1/admin/chapters/{chapterCode}/static-exercises
  alert('√Ä impl√©menter : Modal de cr√©ation d\'exercice statique');
};

const handleEditStatic = (exercise) => {
  // TODO: Ouvrir modal d'√©dition
  // PUT /api/v1/admin/static-exercises/{exercise.id}
  alert(`√Ä impl√©menter : √âdition exercice statique #${exercise.id}`);
};

const handleDeleteStatic = async (exercise) => {
  if (!window.confirm(`Supprimer l'exercice statique #${exercise.id} ?`)) {
    return;
  }
  
  try {
    const response = await fetch(
      `${BACKEND_URL}/api/v1/admin/static-exercises/${exercise.id}`,
      { method: 'DELETE' }
    );
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    // Recharger la liste
    fetchStaticExercises();
    
    // Toast de succ√®s (si disponible)
    console.log('Exercice statique supprim√©');
  } catch (err) {
    console.error('[Static] Erreur suppression:', err);
    alert(`Erreur lors de la suppression: ${err.message}`);
  }
};
```

---

## üß™ Validation

### Test 1 : Onglets Visibles

**URL :** http://localhost:3000/admin/curriculum/6e_GM07/exercises

**Attendu :**
- ‚úÖ 2 onglets en haut de page
- ‚úÖ Onglet "Dynamiques (g√©n√©r√©s)" avec üß©
- ‚úÖ Onglet "Statiques (fig√©s)" avec üìÑ
- ‚úÖ Onglet "Dynamiques" actif par d√©faut

---

### Test 2 : Onglet Dynamiques

**Actions :**
1. Rester sur onglet "Dynamiques"
2. V√©rifier que le contenu existant s'affiche

**Attendu :**
- ‚úÖ Liste des g√©n√©rateurs visible
- ‚úÖ Tous les boutons existants fonctionnent
- ‚úÖ Message p√©dagogique affich√©
- ‚úÖ Lien vers `/admin/templates` visible

---

### Test 3 : Onglet Statiques

**Actions :**
1. Cliquer sur onglet "Statiques"
2. Attendre le chargement

**Attendu :**
- ‚úÖ Spinner pendant chargement
- ‚úÖ Si aucun exercice : √âtat vide avec bouton "Cr√©er"
- ‚úÖ Si exercices : Liste avec colonnes (Type, Titre, Difficult√©, Ordre, Actions)
- ‚úÖ Badge üìÑ "Statique" pour chaque exercice
- ‚úÖ Boutons √âditer/Supprimer visibles

---

### Test 4 : CRUD Statiques

**Actions :**
1. Cliquer "Ajouter un exercice statique"
2. Cliquer "√âditer" sur un exercice
3. Cliquer "Supprimer" sur un exercice

**Attendu (pour l'instant) :**
- ‚úÖ Alertes `"√Ä impl√©menter"` pour Cr√©er/√âditer
- ‚úÖ Confirmation puis suppression pour Supprimer

---

## üöß Limitations Actuelles (MVP)

### √Ä Impl√©menter Plus Tard

1. **Modal Cr√©ation Statique**
   - Formulaire avec : `title`, `enonce_html`, `solution_html`, `difficulty`, `tags`, `order`
   - POST vers `/api/v1/admin/chapters/{code}/static-exercises`

2. **Modal √âdition Statique**
   - M√™me formulaire pr√©-rempli
   - PUT vers `/api/v1/admin/static-exercises/{id}`

3. **√âditeur HTML**
   - Actuellement : `<textarea>` brut
   - Id√©al : √âditeur WYSIWYG ou CodeMirror

4. **Filtres Statiques**
   - Filtrer par difficult√©
   - Filtrer par tags
   - Recherche textuelle

---

## üìÅ Fichiers Modifi√©s

| Fichier | Modifications |
|---------|---------------|
| `ChapterExercisesAdminPage.js` | + Onglets, + √©tat statiques, + fetch, + render |

**Lignes ajout√©es :** ~200  
**Lignes modifi√©es :** ~50  
**Risque de r√©gression :** Mod√©r√© (encapsulation dans onglet)

---

## üîÑ Migration Progressive

### Phase 1 (Actuelle) - MVP Onglets ‚úÖ
- Onglets visibles
- Liste statiques (lecture seule)
- Suppression statique
- Cr√©ation/√âdition : Alertes "√Ä impl√©menter"

### Phase 2 (√Ä faire) - CRUD Complet
- Modal cr√©ation avec formulaire
- Modal √©dition avec formulaire
- Validation c√¥t√© client
- √âditeur HTML basique

### Phase 3 (Futur) - UX Premium
- √âditeur WYSIWYG (TinyMCE / Quill)
- Pr√©visualisation temps r√©el
- Drag & drop pour `order`
- Export/Import exercices statiques

---

## ‚ö†Ô∏è Points d'Attention

### 1. Conflit de Noms

**Probl√®me :** `exercises` (√©tat existant) contient les exercices dynamiques.  
**Solution :** Utiliser `staticExercises` pour les statiques.

### 2. Modal Existant

**Probl√®me :** Modal d'√©dition existant pour dynamiques.  
**Solution :** Cr√©er un nouveau state `staticModalOpen` ou r√©utiliser avec condition.

### 3. Performance

**Probl√®me :** Fichier d√©j√† tr√®s long (2100+ lignes).  
**Solution future :** D√©couper en composants :
- `ChapterDynamicTab.js`
- `ChapterStaticTab.js`
- `StaticExerciseModal.js`

---

## üìù Checklist Impl√©mentation

- [ ] Imports Tabs ajout√©s
- [ ] √âtats onglets ajout√©s
- [ ] Fonction `fetchStaticExercises` cr√©√©e
- [ ] `useEffect` pour charger statiques ajout√©
- [ ] Onglets ins√©r√©s dans le rendu
- [ ] Fonction `renderStaticExercisesTab` cr√©√©e
- [ ] Handlers CRUD statiques ajout√©s
- [ ] Tests manuels pass√©s
- [ ] Aucune r√©gression sur onglet Dynamiques

---

## üéâ R√©sultat Attendu

**Avant (1 page monolithique) :**
```
[Page] Exercices du chapitre
  - Liste m√©lang√©e (statiques + dynamiques)
  - Difficile de diff√©rencier
```

**Apr√®s (2 onglets distincts) :**
```
[Page] Exercices du chapitre
  [Onglet Dynamiques üß©] ‚Üê Par d√©faut
    - G√©n√©rateurs
    - Templates
    - Lien vers /admin/templates
  
  [Onglet Statiques üìÑ]
    - Liste exercices statiques
    - CRUD (Cr√©er, √âditer, Supprimer)
    - √âtat vide si aucun exercice
```

---

**Date de r√©daction :** 2025-12-23  
**Temps estim√© d'impl√©mentation :** 2-3h  
**Complexit√© :** Moyenne (fichier long, mais modifications cibl√©es)

**Status :** ‚è∏Ô∏è **GUIDE COMPLET - PR√äT POUR IMPL√âMENTATION**

