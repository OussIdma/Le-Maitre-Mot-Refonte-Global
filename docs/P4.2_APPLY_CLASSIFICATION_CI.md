# P4.2 ‚Äî APPLY CLASSIFICATION + CI

**Date :** 2025-01-XX  
**Objectif :** Rendre P4.1 "r√©el" : ex√©cuter les tests, g√©n√©rer la classification, mettre √† jour automatiquement DISABLED_GENERATORS

---

## üéØ Objectif

Automatiser compl√®tement le processus de qualit√© des g√©n√©rateurs :
- Ex√©cution automatique des tests
- G√©n√©ration automatique de la classification
- Mise √† jour automatique de `DISABLED_GENERATORS`
- V√©rification CI/CD

---

## üìã Utilisation

### Mode normal (met √† jour les fichiers)

```bash
# Ex√©cuter le quality gate complet
python backend/scripts/run_generators_quality_gate.py
```

**Actions effectu√©es :**
1. Ex√©cute `test_dynamic_generators.py` ‚Üí g√©n√®re `test_results.json`
2. Ex√©cute `classify_generators.py` ‚Üí g√©n√®re `docs/CLASSIFICATION_GENERATEURS.md`
3. Extrait les g√©n√©rateurs d√©sactiv√©s depuis la classification
4. Met √† jour `DISABLED_GENERATORS` dans `backend/generators/factory.py`

### Mode check (v√©rifie sans modifier)

```bash
# V√©rifier que tout est √† jour
python backend/scripts/run_generators_quality_gate.py --check
```

**V√©rifications :**
- `DISABLED_GENERATORS` correspond √† la classification actuelle
- `docs/CLASSIFICATION_GENERATEURS.md` est √† jour

**Exit code :**
- `0` si tout est √† jour
- `1` si des diff√©rences sont d√©tect√©es

### Via Makefile

```bash
# V√©rifier
make generators:check

# Mettre √† jour
make generators:update

# Tests
make test:generators
```

### Via script shell

```bash
# V√©rifier
./scripts/check_generators.sh
```

---

## üß™ Tests backend

**Fichier :** `backend/tests/test_generator_factory_disabled.py`

**Tests inclus :**
- ‚úÖ `list_all()` n'inclut pas les g√©n√©rateurs d√©sactiv√©s
- ‚úÖ `list_all(include_disabled=True)` inclut les g√©n√©rateurs d√©sactiv√©s
- ‚úÖ `get()` retourne `None` pour un g√©n√©rateur d√©sactiv√©
- ‚úÖ `generate()` l√®ve une `ValueError` pour un g√©n√©rateur d√©sactiv√©
- ‚úÖ `get_schema()` retourne `None` pour un g√©n√©rateur d√©sactiv√©
- ‚úÖ `DISABLED_GENERATORS` est tri√© alphab√©tiquement

**Ex√©cution :**
```bash
pytest backend/tests/test_generator_factory_disabled.py -v
```

---

## üîÑ Workflow complet

### 1. D√©veloppement local

```bash
# Ajouter/modifier un g√©n√©rateur
# ...

# Tester et mettre √† jour
python backend/scripts/run_generators_quality_gate.py

# V√©rifier les tests
pytest backend/tests/test_generator_factory_disabled.py -v
```

### 2. CI/CD (recommand√©)

Ajouter dans votre pipeline CI :

```yaml
# Exemple GitHub Actions
- name: Check generators quality
  run: |
    python backend/scripts/run_generators_quality_gate.py --check
    pytest backend/tests/test_generator_factory_disabled.py -v
```

### 3. Pr√©-commit (optionnel)

Ajouter un hook pre-commit :

```bash
#!/bin/bash
# .git/hooks/pre-commit

python backend/scripts/run_generators_quality_gate.py --check
if [ $? -ne 0 ]; then
    echo "‚ùå Quality gate failed. Run: python backend/scripts/run_generators_quality_gate.py"
    exit 1
fi
```

---

## üìä Fichiers g√©n√©r√©s

### `test_results.json`

R√©sultats des tests au format JSON :
```json
{
  "summary": {
    "total": 7,
    "pass": 3,
    "fail": 4,
    "timestamp": "..."
  },
  "results": [...]
}
```

### `docs/CLASSIFICATION_GENERATEURS.md`

Classification automatique avec :
- üü¢ GOLD
- üü† AM√âLIORABLE
- üî¥ D√âSACTIV√â

### `backend/generators/factory.py`

Mise √† jour automatique de :
```python
DISABLED_GENERATORS: List[str] = [
    "GENERATOR_1",
    "GENERATOR_2",
    # ... tri√© alphab√©tiquement
]
```

---

## ‚úÖ Checklist de validation

- [x] Script runner cr√©√© (`run_generators_quality_gate.py`)
- [x] Mode `--check` fonctionnel
- [x] Mise √† jour automatique de `DISABLED_GENERATORS`
- [x] Tests backend ajout√©s
- [x] Makefile cr√©√©
- [x] Script shell cr√©√©
- [ ] CI/CD configur√© (√† faire selon votre infrastructure)

---

## üêõ D√©pannage

### Erreur : "Impossible de trouver DISABLED_GENERATORS"

V√©rifiez que `backend/generators/factory.py` contient bien :
```python
DISABLED_GENERATORS: List[str] = [...]
```

### Erreur : "Tests √©chouent"

V√©rifiez que tous les g√©n√©rateurs sont correctement enregistr√©s dans `GeneratorFactory`.

### Erreur : "Classification non g√©n√©r√©e"

V√©rifiez que `test_results.json` existe et est valide.

---

## üèÅ R√©sultat attendu

√Ä la fin de P4.2 :
- ‚úÖ Tests automatiques ex√©cutables en 1 commande
- ‚úÖ Classification g√©n√©r√©e automatiquement
- ‚úÖ `DISABLED_GENERATORS` mis √† jour automatiquement
- ‚úÖ V√©rification CI possible
- ‚úÖ Tests backend passent
- ‚úÖ Z√©ro r√©gression sur `/generate`

---

**Document g√©n√©r√© automatiquement le :** 2025-01-XX  
**Derni√®re mise √† jour :** 2025-01-XX




